<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Happy Chocolate Day Sweetie! üç´</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Poppins:wght@400;600&family=Pacifico&display=swap"
      rel="stylesheet"
    />

    <script>
      !(function (t, e) {
        var o, n, p, r;
        e.__SV ||
          ((window.posthog = e),
          (e._i = []),
          (e.init = function (i, s, a) {
            function g(t, e) {
              var o = e.split(".");
              2 == o.length && ((t = t[o[0]]), (e = o[1])),
                (t[e] = function () {
                  t.push([e].concat(Array.prototype.slice.call(arguments, 0)));
                });
            }
            ((p = t.createElement("script")).type = "text/javascript"),
              (p.crossOrigin = "anonymous"),
              (p.async = !0),
              (p.src =
                s.api_host.replace(".i.posthog.com", "-assets.i.posthog.com") +
                "/static/array.js"),
              (r = t.getElementsByTagName("script")[0]).parentNode.insertBefore(
                p,
                r
              );
            var u = e;
            for (
              void 0 !== a ? (u = e[a] = []) : (a = "posthog"),
                u.people = u.people || [],
                u.toString = function (t) {
                  var e = "posthog";
                  return (
                    "posthog" !== a && (e += "." + a), t || (e += " (stub)"), e
                  );
                },
                u.people.toString = function () {
                  return u.toString(1) + ".people (stub)";
                },
                o =
                  "init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug getPageViewId".split(
                    " "
                  ),
                n = 0;
              n < o.length;
              n++
            )
              g(u, o[n]);
            e._i.push([i, s, a]);
          }),
          (e.__SV = 1));
      })(document, window.posthog || []);
      posthog.init("phc_LQOBMSZqD8kmiAUXW7IudwlBIJXwKNf5C5xnNa70S3h", {
        api_host: "https://us.i.posthog.com",
        person_profiles: "always",
      });
    </script>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        min-height: 100vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-family: "Poppins", sans-serif;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
        /* Animated Gradient Background */
        background: linear-gradient(-45deg, #ff9a9e, #fad0c4, #ffdde1, #ee9ca7);
        background-size: 400% 400%;
        animation: gradientBG 15s ease infinite;
      }

      @keyframes gradientBG {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      /* --- BACKGROUND FLOATING ITEMS --- */
      .bg-floater {
        position: absolute;
        font-size: 24px;
        pointer-events: none;
        z-index: 0;
        animation: floatUpBg 10s linear infinite;
        opacity: 0;
      }
      @keyframes floatUpBg {
        0% {
          transform: translateY(110vh) scale(0.5) rotate(0deg);
          opacity: 0;
        }
        20% {
          opacity: 0.6;
        }
        80% {
          opacity: 0.6;
        }
        100% {
          transform: translateY(-10vh) scale(1.2) rotate(360deg);
          opacity: 0;
        }
      }

      .container {
        width: 100%;
        height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        perspective: 1200px;
        z-index: 10;
      }

      h1 {
        color: #b91c49;
        text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.6);
        margin-bottom: 2rem;
        text-align: center;
        font-size: 2rem;
        font-family: "Dancing Script", cursive;
        padding: 0 10px;
        z-index: 20;
      }

      /* --- STAGE --- */
      .stage-area {
        position: relative;
        width: 600px;
        height: 300px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* --- CHOCOLATE --- */
      .chocolate {
        position: absolute;
        width: 500px;
        height: 240px;
        background: #3e1e1e;
        border-radius: 4px;
        z-index: 5;
        padding: 10px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        transition: filter 0.3s;
      }
      .chocolate.locked {
        filter: grayscale(0.8) brightness(0.6);
      }

      .chocolate-pieces {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        grid-template-rows: repeat(3, 1fr);
        gap: 5px;
        width: 100%;
        height: 100%;
      }

      .piece {
        background: linear-gradient(
          135deg,
          #5d3a3a 0%,
          #4e2d2d 50%,
          #381a1a 100%
        );
        border-radius: 3px;
        cursor: pointer;
        position: relative;
        box-shadow: inset 2px 2px 2px rgba(255, 255, 255, 0.1),
          inset -2px -2px 4px rgba(0, 0, 0, 0.4);
        transition: transform 0.1s;
      }
      .piece:active {
        transform: scale(0.95);
      }

      .piece::after {
        content: "KitKat";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) rotate(-25deg);
        color: rgba(60, 20, 20, 0.5);
        font-family: "Dancing Script", cursive;
        font-size: 1.3rem;
        pointer-events: none;
      }

      .piece.eaten {
        opacity: 0;
        transform: scale(0.5);
        pointer-events: none;
        transition: opacity 0.3s, transform 0.3s;
      }

      /* --- WRAPPER --- */
      .wrapper {
        position: absolute;
        width: 580px;
        height: 260px;
        z-index: 100;
        cursor: grab;
        left: 50%;
        top: 50%;
        /* Initial Center Position */
        transform: translate(-50%, -50%);
        background: #d12e2e;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        border-radius: 4px;
        /* CRITICAL: Prevents default browser drag handling */
        touch-action: none;
        user-select: none;
      }

      .wrapper:active {
        cursor: grabbing;
      }

      .wrapper.crumpled {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        /* Move to trash starting position (bottom left) */
        left: 15%;
        top: 80%;
        transform: translate(-50%, -50%) rotate(15deg);
        background: radial-gradient(circle, #d12e2e 0%, #801010 100%);
        box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.4);
        cursor: grabbing;
        z-index: 200;
        transition: width 0.3s, height 0.3s, border-radius 0.3s; /* Smooth morph only */
      }

      .wrapper.crumpled .wrapper-img,
      .wrapper.crumpled .wrapper-hint,
      .wrapper.crumpled::before,
      .wrapper.crumpled::after,
      .wrapper.crumpled .glare {
        display: none;
      }

      .wrapper.crumpled::after {
        content: "";
        display: block;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: repeating-linear-gradient(
          45deg,
          rgba(0, 0, 0, 0.1) 0px,
          rgba(0, 0, 0, 0.1) 5px,
          transparent 5px,
          transparent 10px
        );
      }

      .wrapper-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 4px;
        pointer-events: none;
      }

      .wrapper::before,
      .wrapper::after {
        content: "";
        position: absolute;
        top: 0;
        width: 25px;
        height: 100%;
        background: repeating-linear-gradient(
          90deg,
          #b02525 0px,
          #901515 2px,
          #b02525 4px
        );
        border: 1px solid #801010;
      }
      .wrapper::before {
        left: -15px;
        -webkit-mask: linear-gradient(to right, transparent 5%, black 20%);
      }
      .wrapper::after {
        right: -15px;
        -webkit-mask: linear-gradient(to left, transparent 5%, black 20%);
      }

      .glare {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        background: linear-gradient(
          135deg,
          transparent 40%,
          rgba(255, 255, 255, 0.3) 50%,
          transparent 60%
        );
      }

      .wrapper-hint {
        position: absolute;
        right: 40px;
        bottom: 20px;
        color: #fff;
        font-size: 0.8rem;
        font-weight: bold;
        animation: pulse 2s infinite;
        pointer-events: none;
        text-shadow: 1px 1px 2px black;
      }
      @keyframes pulse {
        0%,
        100% {
          transform: translateX(0);
        }
        50% {
          transform: translateX(5px);
        }
      }

      /* --- DUSTBIN --- */
      .dustbin {
        position: fixed;
        bottom: 20px;
        right: 20px;
        font-size: 3rem;
        z-index: 50;
        background: rgba(255, 255, 255, 0.4);
        width: 80px;
        height: 80px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px dashed #d6336c;
        transition: transform 0.2s;
      }
      .dustbin.drag-over {
        transform: scale(1.3);
        background: rgba(255, 105, 180, 0.6);
        border-style: solid;
      }
      .dustbin.shake {
        animation: shakeBin 0.5s ease-in-out;
        background: rgba(255, 0, 0, 0.2);
      }
      .dustbin::after {
        content: "üóëÔ∏è";
        filter: drop-shadow(2px 2px 2px rgba(0, 0, 0, 0.2));
      }

      @keyframes shakeBin {
        0%,
        100% {
          transform: rotate(0deg);
        }
        25% {
          transform: rotate(-10deg);
        }
        75% {
          transform: rotate(10deg);
        }
      }

      /* --- COMMENTS --- */
      .float-text {
        position: fixed;
        color: #ff1493;
        font-family: "Pacifico", cursive;
        font-size: 2rem;
        pointer-events: none;
        z-index: 2000;
        text-shadow: 2px 2px 0px #fff, 0 0 10px rgba(255, 105, 180, 0.5);
        animation: floatUp 2.5s ease-out forwards;
        white-space: nowrap;
      }
      @keyframes floatUp {
        0% {
          opacity: 0;
          transform: translate(-50%, 0) scale(0.5) rotate(-5deg);
        }
        20% {
          opacity: 1;
          transform: translate(-50%, -30px) scale(1.2) rotate(5deg);
        }
        100% {
          opacity: 0;
          transform: translate(-50%, -150px) scale(1) rotate(0deg);
        }
      }

      /* --- OVERLAYS --- */
      .overlay-msg {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 90%;
        max-width: 500px;
        background: rgba(80, 20, 40, 0.9);
        backdrop-filter: blur(8px);
        border: 2px solid rgba(255, 255, 255, 0.2);
        color: #fff;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 3000;
        border-radius: 15px;
        padding: 30px 20px;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        animation: popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }
      @keyframes popIn {
        from {
          transform: translate(-50%, -50%) scale(0.8);
          opacity: 0;
        }
        to {
          transform: translate(-50%, -50%) scale(1);
          opacity: 1;
        }
      }

      .overlay-msg h2 {
        font-family: "Pacifico", cursive;
        color: #ff69b4;
        margin-bottom: 15px;
        font-size: 2rem;
      }

      .shayari-text {
        font-family: "Dancing Script", cursive;
        font-size: 1.8rem;
        line-height: 1.8;
        margin: 10px 0;
        color: #ffe0e6;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        text-align: justify;
        text-align-last: center;
        width: 100%;
      }

      .btn-reset {
        background: #ff69b4;
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 30px;
        font-weight: bold;
        font-size: 1.1rem;
        margin-top: 20px;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(255, 105, 180, 0.4);
        transition: transform 0.2s;
      }
      .btn-reset:active {
        transform: scale(0.95);
      }

      /* --- RESPONSIVE --- */
      @media (max-width: 768px) {
        .stage-area {
          width: 100%;
          height: auto;
          aspect-ratio: 2/1;
        }
        .wrapper {
          width: 92vw;
          height: 50vw;
        }
        .chocolate {
          width: 85vw;
          height: 46vw;
        }
        .wrapper::before,
        .wrapper::after {
          width: 15px;
          left: -10px;
        }
        .wrapper::after {
          right: -10px;
          left: auto;
        }
        .dustbin {
          width: 70px;
          height: 70px;
          font-size: 2.5rem;
          bottom: 15px;
          right: 15px;
        }
        h1 {
          font-size: 1.5rem;
          margin-top: 1rem;
        }
        .shayari-text {
          font-size: 1.3rem;
          line-height: 1.5;
        }
        .overlay-msg h2 {
          font-size: 1.5rem;
        }
      }

      .credits {
        position: fixed;
        bottom: 15px;
        left: 15px;
        font-size: 0.8rem;
        color: #d6336c;
        font-weight: bold;
        background: rgba(255, 255, 255, 0.6);
        padding: 5px 10px;
        border-radius: 10px;
      }
    </style>
  </head>
  <body>
    <div id="bg-container"></div>

    <div class="container">
      <h1>Oyee, Happy Chocolate Day Sweetie! üç´</h1>

      <div class="stage-area">
        <div class="wrapper" id="wrapper">
          <img
            src="https://www.bbassets.com/media/uploads/p/l/40122230_15-nestle-kitkat-crispy-wafer-bar.jpg"
            class="wrapper-img"
            alt="Wrapper"
          />
          <div class="glare"></div>
          <div class="wrapper-hint">Slide Right to Open &raquo;</div>
        </div>
        <div class="chocolate" id="chocolate">
          <div class="chocolate-pieces" id="pieces-container"></div>
        </div>
      </div>

      <p
        style="
          margin-top: 20px;
          color: #b91c49;
          font-weight: 600;
          opacity: 0.9;
          text-align: center;
          font-size: 0.9rem;
        "
      >
        Unwrap, Bin the Wrapper & Eat! ‚ôªÔ∏è
      </p>
    </div>

    <div class="dustbin" id="dustbin"></div>
    <div class="credits">Made with love ‚ù§Ô∏è by Ravikant</div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const wrapper = document.getElementById("wrapper");
        const chocolate = document.getElementById("chocolate");
        const piecesContainer = document.getElementById("pieces-container");
        const dustbin = document.getElementById("dustbin");

        // --- CONSTANTS ---
        const ROWS = 3,
          COLS = 5;
        const DAILY_LIMIT = 2;

        // --- STATE VARIABLES ---
        let chocolateGrid = Array(ROWS)
          .fill()
          .map(() => Array(COLS).fill(false));
        let isUnwrapped = false;
        let isTrashMode = false;
        let isWrapperBinned = false;

        // --- DRAG STATE ---
        let dragStart = { x: 0, y: 0 };
        let currentTranslate = { x: 0, y: 0 };
        let initialTranslate = { x: 0, y: 0 };
        let isDragging = false;

        // --- AUDIO ---
        const sfxUnwrap = new Audio("unwrap-sound.mp3");
        const sfxEat = new Audio("eating-sound.mp3");

        const loveNotes = [
          "So beautiful",
          "Absolutely stunning",
          "Pure elegance",
          "Lovely vibes",
          "Simply gorgeous",
          "Total beauty",
          "Glowing always",
          "Dream girl",
          "Angel energy",
          "Picture perfect",
          "Radiant smile",
          "Golden heart",
          "Sweet soul",
          "Forever lovely",
          "Natural beauty",
          "Queen vibes",
          "Soft elegance",
          "Magic moments",
          "Timeless charm",
          "Pretty perfection",
          "Heart melting",
          "Stunning grace",
          "Effortless beauty",
          "Warm aura",
          "Cute vibes",
          "Beauty overload",
          "Lovely glow",
          "Charming look",
          "Elegant queen",
          "Pure magic",
          "Sweet elegance",
          "Gorgeous soul",
          "Flawless vibes",
          "Bright smile",
          "Loving energy",
          "Beautiful spirit",
          "Serene beauty",
          "Graceful presence",
          "Sunshine vibes",
          "Classy beauty",
          "Soft glow",
          "Heart stealer",
          "Divine beauty",
          "Simply lovely",
          "Endless charm",
          "Pretty soul",
          "Calm elegance",
          "Sweet beauty",
          "Lovely queen",
          "True beauty",
        ];

        // --- BG ANIMATION ---
        const bgEmojis = ["‚ù§Ô∏è", "üíñ", "üç´", "üç¨", "‚ú®", "üíù"];
        setInterval(() => {
          const el = document.createElement("div");
          el.className = "bg-floater";
          el.textContent =
            bgEmojis[Math.floor(Math.random() * bgEmojis.length)];
          el.style.left = Math.random() * 100 + "vw";
          el.style.animationDuration = Math.random() * 5 + 8 + "s";
          document.getElementById("bg-container").appendChild(el);
          setTimeout(() => el.remove(), 13000);
        }, 800);

        // --- LIMIT CHECK ---
        function checkLimit(strict = false) {
          const today = new Date().toDateString();
          if (localStorage.getItem("chocDate") !== today) {
            localStorage.setItem("chocDate", today);
            localStorage.setItem("barsEaten", "0");
            localStorage.setItem("piecesEaten", "0");
          }
          const bars = parseInt(localStorage.getItem("barsEaten") || "0");
          if (bars >= DAILY_LIMIT) {
            if (strict) showFinalShayari();
            return true;
          }
          return false;
        }

        // --- SETUP ---
        function initBoard() {
          piecesContainer.innerHTML = "";
          for (let r = 0; r < ROWS; r++) {
            for (let c = 0; c < COLS; c++) {
              const piece = document.createElement("div");
              piece.className = "piece";
              const eatHandler = (e) => {
                e.preventDefault();
                eatPiece(r, c, piece, e);
              };
              piece.addEventListener("click", eatHandler);
              piecesContainer.appendChild(piece);
            }
          }
        }

        function isEatable(r, c) {
          if (r === 0 || r === ROWS - 1 || c === 0 || c === COLS - 1)
            return true;
          const neighbors = [
            [r - 1, c],
            [r + 1, c],
            [r, c - 1],
            [r, c + 1],
          ];
          return neighbors.some(([nr, nc]) => chocolateGrid[nr][nc]);
        }

        // --- EATING LOGIC ---
        function eatPiece(r, c, el, e) {
          if (!isUnwrapped) {
            // Wiggle visual cue
            wrapper.style.transition = "transform 0.1s";
            wrapper.style.transform = "translate(-48%, -50%)";
            setTimeout(
              () => (wrapper.style.transform = "translate(-50%, -50%)"),
              100
            );
            return;
          }

          let x =
            e.clientX ||
            (e.changedTouches
              ? e.changedTouches[0].clientX
              : window.innerWidth / 2);
          let y =
            e.clientY ||
            (e.changedTouches
              ? e.changedTouches[0].clientY
              : window.innerHeight / 2);

          if (!isWrapperBinned) {
            showFloatingText(x, y, "Bin the wrapper first! üõë");
            dustbin.classList.add("shake");
            setTimeout(() => dustbin.classList.remove("shake"), 500);
            return;
          }

          if (checkLimit(true) || chocolateGrid[r][c]) return;

          if (isEatable(r, c)) {
            chocolateGrid[r][c] = true;
            el.classList.add("eaten");
            sfxEat.currentTime = 0;
            sfxEat.play().catch(() => {});

            showFloatingText(x, y);

            let sessionEaten = chocolateGrid.flat().filter((x) => x).length;
            if (sessionEaten === ROWS * COLS) {
              let b = parseInt(localStorage.getItem("barsEaten") || "0") + 1;
              localStorage.setItem("barsEaten", b);
              setTimeout(() => {
                if (b >= DAILY_LIMIT) showFinalShayari();
                else
                  showMsg(
                    "Delicious, Yummy? üç´",
                    "Bs Kro cavity ho jayegi. ok ok Ready for one more?",
                    false
                  );
              }, 800);
            }
          } else {
            el.style.transform = "scale(0.9)";
            setTimeout(() => (el.style.transform = "scale(1)"), 150);
          }
        }

        function showFloatingText(x, y, customMsg = null) {
          const txt = document.createElement("div");
          txt.className = "float-text";
          txt.textContent =
            customMsg ||
            loveNotes[Math.floor(Math.random() * loveNotes.length)];
          let safeX = Math.min(Math.max(x, 50), window.innerWidth - 100);
          let safeY = Math.min(Math.max(y, 50), window.innerHeight - 50);
          txt.style.left = safeX + "px";
          txt.style.top = safeY + "px";
          if (customMsg) txt.style.color = "#d6336c";
          document.body.appendChild(txt);
          setTimeout(() => txt.remove(), 2500);
        }

        // --- PERFECT DRAG ENGINE (Delta Method) ---

        function dragStartHandler(e) {
          if (checkLimit(true)) return;

          // Allow interaction
          if (e.cancelable && !isTrashMode) e.preventDefault();

          const clientX = e.type.includes("touch")
            ? e.touches[0].clientX
            : e.clientX;
          const clientY = e.type.includes("touch")
            ? e.touches[0].clientY
            : e.clientY;

          // Sync initial drag point relative to current translation
          initialTranslate.x = currentTranslate.x;
          initialTranslate.y = currentTranslate.y;

          dragStart.x = clientX;
          dragStart.y = clientY;

          isDragging = true;
          wrapper.style.transition = "none";
          wrapper.style.cursor = "grabbing";
        }

        function dragHandler(e) {
          if (!isDragging) return;

          // Prevent scrolling on mobile during trash drag
          if (isTrashMode && e.cancelable) e.preventDefault();

          const clientX = e.type.includes("touch")
            ? e.touches[0].clientX
            : e.clientX;
          const clientY = e.type.includes("touch")
            ? e.touches[0].clientY
            : e.clientY;

          const deltaX = clientX - dragStart.x;
          const deltaY = clientY - dragStart.y;

          if (!isTrashMode) {
            // MODE 1: UNWRAP (Horizontal Slide)
            // We only update X. Y stays centered.
            // currentTranslate is stored for logic, but CSS uses translate(-50%, -50%) + offset
            // To keep it simple, we just transform directly here.
            if (deltaX > 0) {
              wrapper.style.transform = `translate(calc(-50% + ${deltaX}px), -50%)`;
              currentTranslate.x = deltaX; // Store progress
            }
          } else {
            // MODE 2: TRASH (Free Move)
            // Update current position based on initial + delta
            currentTranslate.x = initialTranslate.x + deltaX;
            currentTranslate.y = initialTranslate.y + deltaY;

            // Rotate slightly based on X movement
            wrapper.style.transform = `translate(${currentTranslate.x}px, ${
              currentTranslate.y
            }px) rotate(${15 + currentTranslate.x / 5}deg)`;

            // Collision visual feedback
            if (isPointOverBin(clientX, clientY))
              dustbin.classList.add("drag-over");
            else dustbin.classList.remove("drag-over");
          }
        }

        function dragEndHandler(e) {
          if (!isDragging) return;
          isDragging = false;
          wrapper.style.cursor = "grab";

          if (!isTrashMode) {
            // Unwrap Threshold (Slide > 50px)
            if (currentTranslate.x > 50) {
              triggerUnwrapState();
            } else {
              // Snap back
              wrapper.style.transition = "transform 0.3s ease";
              wrapper.style.transform = "translate(-50%, -50%)";
              currentTranslate.x = 0;
            }
          } else {
            // Trash Drop Check
            // We need the last known coordinates.
            // Mouseup doesn't give coords, Touchend changedTouches does.
            let finalX, finalY;
            if (e.type.includes("touch")) {
              finalX = e.changedTouches[0].clientX;
              finalY = e.changedTouches[0].clientY;
            } else {
              finalX = e.clientX;
              finalY = e.clientY;
            }

            if (isPointOverBin(finalX, finalY)) {
              // SUCCESS
              sfxUnwrap.play().catch(() => {});
              wrapper.style.transition = "all 0.5s ease";
              wrapper.style.transform = "scale(0)";
              wrapper.style.opacity = "0";
              dustbin.classList.remove("drag-over");

              // Shake bin
              dustbin.classList.add("shake");
              setTimeout(() => dustbin.classList.remove("shake"), 500);

              isWrapperBinned = true;
              chocolate.classList.remove("locked");

              // Show message near bin
              const rect = dustbin.getBoundingClientRect();
              showFloatingText(
                rect.left,
                rect.top - 50,
                "Good Girl! Now Eat! üíñ"
              );
            } else {
              dustbin.classList.remove("drag-over");
              // Stay where dropped (Physics feel)
            }
          }
        }

        function triggerUnwrapState() {
          isUnwrapped = true;
          isTrashMode = true;
          sfxUnwrap.play().catch(() => {});

          wrapper.classList.add("crumpled");
          // IMPORTANT: Reset transform logic variables!
          // The CSS .crumpled moves it to bottom-left (10%, 80%).
          // We need to reset our manual transforms so CSS takes over initially.
          wrapper.style.transform = "";

          // Reset tracking variables to 0, because now movement is relative to the new CSS position
          currentTranslate = { x: 0, y: 0 };
          initialTranslate = { x: 0, y: 0 };

          chocolate.classList.add("locked");
        }

        function isPointOverBin(x, y) {
          const rect = dustbin.getBoundingClientRect();
          const pad = 30; // Hitbox padding
          return (
            x >= rect.left - pad &&
            x <= rect.right + pad &&
            y >= rect.top - pad &&
            y <= rect.bottom + pad
          );
        }

        // Events
        wrapper.addEventListener("touchstart", dragStartHandler, {
          passive: false,
        });
        window.addEventListener("touchmove", dragHandler, { passive: false });
        window.addEventListener("touchend", dragEndHandler);

        wrapper.addEventListener("mousedown", dragStartHandler);
        window.addEventListener("mousemove", dragHandler);
        window.addEventListener("mouseup", dragEndHandler);

        function showMsg(title, txt, isFinal) {
          if (document.querySelector(".overlay-msg")) return;
          const d = document.createElement("div");
          d.className = "overlay-msg";
          d.innerHTML = `<h2>${title}</h2><p style="margin-top:10px; line-height:1.5; font-size:1.1rem;">${txt}</p><button class="btn-reset" onclick="location.reload()">Okay Sweetie! üíñ</button>`;
          document.body.appendChild(d);
        }

        function showFinalShayari() {
          if (document.querySelector(".overlay-msg")) return;
          const d = document.createElement("div");
          d.className = "overlay-msg";
          d.innerHTML = `
                    <h2>For My Sweetie... üåπ</h2>
                    <div class="shayari-text">
                        Sweetness Overload, Remember! You‚Äôre like chocolate
                        soft, sweet,
                        and somehow always
                        on my mind üç´üíñ‚ù§Ô∏è
                    </div>
                    <button class="btn-reset" onclick="location.reload()">OK Bye! üíñ</button>
                `;
          document.body.appendChild(d);
        }

        if (checkLimit()) {
          showFinalShayari();
          wrapper.style.display = "none";
        } else {
          initBoard();
        }
      });
    </script>
  </body>
</html>
